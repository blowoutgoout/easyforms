$(document).ready(function(){var o="#475e98";var n="#9B59B6";var m="#F8B700";var k="#78CC00";var j="#7B71C5";var g="#56B2EA";var f="#E064CD";var a=[o,n,m,k,j,g,f];var p=dc.compositeChart("#overview-chart");var c=dc.pieChart("#year-chart");var d=dc.barChart("#month-chart");var l=dc.rowChart("#day-of-week-chart");var i=dc.barChart("#conversion-time-chart");var b=dc.compositeChart("#conversion-time-line-chart");var h=dc.pieChart("#abandonment-chart");var e=dc.compositeChart("#abandonment-time-chart");d3.csv(options.endPoint,function(T){var V=d3.time.format("%Y-%m-%d").parse;var P=d3.time.format("%M:%S");T.forEach(function(W){W.users=+W.users;W.fills=+W.fills;W.conversions=+W.conversions;W.conversionTime=+W.conversionTime;W.abandonments=W.fills-W.conversions;W.abandonmentRate=Math.round((W.abandonments)/W.users*100);W.date=V(W.day);W.year=W.date.getFullYear()});function D(W){return function(Y,X){W.forEach(function(Z){Y[Z]+=X[Z]});return Y}}function N(W){return function(Y,X){W.forEach(function(Z){Y[Z]-=X[Z]});return Y}}function q(W){return function(){var X={};W.forEach(function(Y){X[Y]=0});return X}}var H=["users","fills","conversions"];var t=crossfilter(T);var r=t.groupAll();var E=t.dimension(function(W){return W.date});var U=E.group().reduceSum(function(W){return W.users});var Q=E.group().reduceSum(function(W){return W.fills});var u=E.group().reduceSum(function(W){return W.conversions});var A=t.dimension(function(W){return W.year});var I=A.group().reduce(D(H),N(H),q(H));var z=options.i18n.months;var K=t.dimension(function(X){var W=X.date.getMonth();return z[W]});var v=K.group().reduce(D(H),N(H),q(H));var J=t.dimension(function(Y){var W=Y.date.getDay();var X=options.i18n.days;return W+"."+X[W]});var y=J.group().reduce(D(H),N(H),q(H));var s=t.dimension(function(X){var W;if(X.conversionTime<120){W="0 - 2"}else{if(X.conversionTime<240){W="2 - 4"}else{if(X.conversionTime<360){W="4 - 6"}else{if(X.conversionTime<600){W="6 - 10"}else{W="+ 10"}}}}return W});var C=s.group().reduceSum(function(W){return W.conversions});var F=E.group().reduceSum(function(W){return W.conversionTime});function O(Y,X){var W=Y.groupAll().reduce(function(aa,Z){X.forEach(function(ab){aa[ab]+=Z[ab]});return aa},function(aa,Z){X.forEach(function(ab){aa[ab]-=Z[ab]});return aa},function(){var Z={};X.forEach(function(aa){Z[aa]=0});return Z});return{all:function(){return d3.map(W.value()).entries()}}}var S=t.dimension(function(W){return W.a});var G=O(S,["conversions","abandonments"]);var L=E.group().reduceSum(function(W){return W.abandonmentRate});function M(){var ac=E.top(Infinity);var Y=0,Z=0,ab=0;$.each(ac,function(ad,ae){$.each(ae,function(af,ag){if(af==="users"){Y+=ag}else{if(af==="fills"){Z+=ag}else{if(af==="conversions"){ab+=ag}}}})});var W=isNaN(Math.round(Z/Y*100))?0:Math.round(Z/Y*100),aa=isNaN(Math.round(ab/Z*100))?0:Math.round(ab/Z*100),X=isNaN(Math.round(ab/Y*100))?0:Math.round(ab/Y*100);$("#users-number").text(Y);$("#fills-number").text(Z);$("#conversions-number").text(ab);$("#fills-rate").text(W);$("#completition-rate").text(aa);$("#conversion-rate").text(X)}dc.dataCount(".data-count").dimension(t).group(r);var x=(typeof E.bottom(1)[0]!="undefined")?E.bottom(1)[0].date:0;var B=(typeof E.top(1)[0]!="undefined")?E.top(1)[0].date:0;p.width($("#overview").width()).height(280).x(d3.time.scale().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(10).legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).title(function(X){var W=(X.key.getMonth()+1)+"/"+X.key.getDate()+"/"+X.key.getFullYear();return" "+W+" \n "+X.value}).on("preRender",M).brushOn(false).compose([dc.lineChart(p).dimension(E).colors(o).renderArea(false).group(U,options.i18n.users),dc.lineChart(p).dimension(E).colors(n).renderArea(false).dashStyle([15,10]).group(Q,options.i18n.beganFilling),dc.lineChart(p).dimension(E).colors(m).renderArea(true).group(u,options.i18n.conversions)]).render();var w=$("#year").width();c.width(w).height(230).dimension(A).group(I).valueAccessor(function(W){return W.value.conversions}).innerRadius(75).renderLabel(false).renderTitle(true).title(function(X){var W=X.key+" \n";W+=X.value.users+" "+options.i18n.users+" \n";W+=X.value.fills+" "+options.i18n.beganFilling+" \n";W+=X.value.conversions+" "+options.i18n.conversions;return W}).ordinalColors(a).legend(dc.legend().x(Math.round((w*50/100)-18)).y(95).itemHeight(13).gap(5)).on("filtered",M);d.width($("#month").width()).height(250).dimension(K).group(v).valueAccessor(function(W){return W.value.conversions}).title(function(X){var W=X.key+" \n";W+=X.value.users+" "+options.i18n.users+" \n";W+=X.value.fills+" "+options.i18n.beganFilling+" \n";W+=X.value.conversions+" "+options.i18n.conversions;return W}).brushOn(false).ordinalColors(a).on("filtered",M).x(d3.scale.ordinal().domain(z)).xUnits(dc.units.ordinal).elasticY(true);l.width($("#week").width()).height(240).margins({top:0,left:10,right:10,bottom:20}).dimension(J).group(y).valueAccessor(function(W){return W.value.conversions}).ordinalColors(a).label(function(W){return W.key.split(".")[1]}).title(function(X){var W=X.key.split(".")[1]+" \n";W+=X.value.users+" "+options.i18n.users+" \n";W+=X.value.fills+" "+options.i18n.beganFilling+" \n";W+=X.value.conversions+" "+options.i18n.conversions;return W}).on("filtered",M).elasticX(true).xAxis().ticks(4);i.width($("#conversion-time").width()).height(253).group(C).dimension(s).ordinalColors(a).brushOn(false).on("filtered",M).x(d3.scale.ordinal().domain(["0 - 2","2 - 4","4 - 6","6 - 10","+ 10"])).xAxisLabel(options.i18n.minutes).xUnits(dc.units.ordinal).elasticY(true);b.width($("#conversion-time-line").width()).height(240).x(d3.time.scale().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(50).yAxisLabel("").legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).title(function(X){var W=(X.key.getMonth()+1)+"/"+X.key.getDate()+"/"+X.key.getFullYear();return" "+W+" \n "+P(new Date(2015,0,1,0,0,X.value))}).on("preRender",M).brushOn(false).compose([dc.lineChart(b).dimension(E).colors(n).renderArea(true).group(F,options.i18n.medianPerDay)]).render();b.yAxis().tickFormat(function(W){return P(new Date(2015,0,1,0,0,W))});var R=$("#abandonment").width();h.width(R).height(230).dimension(S).group(G).innerRadius(75).renderLabel(false).renderTitle(true).ordinalColors(a).title(function(W){return W.value+" "+W.key}).legend(dc.legend().x(Math.round((R*50/100)-43)).y(95).itemHeight(13).gap(5));h.filter=function(){};e.width($("#abandonment-time").width()).height(240).x(d3.time.scale().domain([x,B])).elasticY(true).elasticX(true).yAxisPadding(50).legend(dc.legend().x(50).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(true).title(function(X){var W=(X.key.getMonth()+1)+"/"+X.key.getDate()+"/"+X.key.getFullYear();return W+"\n"+X.value+"%"}).on("preRender",M).brushOn(false).compose([dc.lineChart(e).dimension(E).colors(o).renderArea(true).group(L,options.i18n.medianPerDay)]).render();e.yAxis().tickFormat(function(W){return W+"%"});dc.renderAll()})});
jQuery(document).ready(function(){function e(){Utils.postMessage({height:$("body").outerHeight(!0)})}function t(){$(".error-block").remove(),$(".form-group").removeClass("has-error")}function s(){t(),formEl.find(":submit").attr("disabled",!1),formEl.resetForm(),d.hide()}function o(e){options.submitted=!0;var t=(new Date).getTime()-g;if(formEl.trigger("success",[e,t]),c.size()>1){var s=$(".steps");if(s.size()>0)s.find(".step").addClass("success");else{var o=$(".progress").first().find(".progress-bar"),i=o.find(".percent");o.find(".title").html("Complete"),i.text("100%"),o.width("100%")}}if(void 0!==e.addon&&void 0!==e.addon.redirectTo&&Utils.postMessage({url:e.addon.redirectTo}),options.confirmationType===options.redirectToUrl)Utils.postMessage({url:void 0===e.confirmationUrl?options.confirmationUrl:e.confirmationUrl});else{var r=options.confirmationMessage?options.confirmationMessage:e.message;Utils.hideMessage("#messages"),Utils.showMessage("#messages",r,"success"),options.confirmationType===options.showOnlyMessage&&formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}}function r(e){if(Utils.hideMessage("#messages"),void 0!==e.message&&Utils.showMessage("#messages",e.message,"danger"),Utils.postMessage({scrollToTop:"container"}),t(),void 0!==e.errors&&e.errors.length>0){var s=e.errors;for(k=0;k<s.length;k++){var o=$("#"+s[k].field).parent(".form-group");for(o.addClass("has-error"),i=0;i<s[k].messages.length;i++){var r=$("<div>",{class:"help-block error-block",html:s[k].messages[i]});o.append(r)}}}formEl.find(":submit").removeAttr("disabled"),Utils.postMessage({height:$("body").outerHeight(!0)}),formEl.trigger("error",e)}window.formEl=$(options.name);var n,a,l,d=$("#progress"),p=$("#bar"),f=$("#percent"),c=$("fieldset");formEl.attr("role","form"),$("<input>").attr({type:"hidden",id:"_csrf",name:"_csrf",value:options._csrf}).appendTo(formEl),options.autocomplete?formEl.attr("autocomplete","on"):formEl.attr("autocomplete","off"),options.novalidate?formEl.attr("novalidate","novalidate"):"novalidate"!==formEl.attr("novalidate")&&formEl.removeAttr("novalidate"),options.resume&&formEl.resume({key:"form_app_"+options.id});var u;jQuery(window).resize(function(){clearTimeout(u),u=setTimeout(e,50)}),jQuery(window).load(function(){if(Utils.postMessage({height:$("body").outerHeight(!0)}),"preview"===options.mode)return!1;options.defaultValues&&(options.defaultValues=JSON.parse(options.defaultValues),$.each(options.defaultValues,function(e,t){var s=e.split("_",1);"checkbox"==s||"radio"==s?$("#"+e).prop("checked",t):$("#"+e).val(t)})),formEl.trigger("view")});var m=!1,g=0;formEl.find(":input").each(function(){$(this).one("change",function(){if(!1===m){if("preview"===options.mode)return!1;g=(new Date).getTime(),formEl.trigger("fill")}m=!0})}),window.nextStep=function(e){e.preventDefault();var t=this,s=!1;if(a=$(e.currentTarget).parents("fieldset").next(),n=$(t).parents("fieldset"),options.skips.length>0)for(var o=0;o<options.skips.length;o++)if(c.index(n)<options.skips[o].to){var i=c.eq(options.skips[o].to);if(c.index(n)<c.index(i)){null!=options.skips[o].from&&options.skips[o].from!=c.index(n)||(options.skips[o].from=c.index(n),a=i);break}}a.is("fieldset")&&$.ajax({url:options.validationUrl,type:"post",data:formEl.serialize(),complete:function(e,t){},beforeSend:function(e,t){var s=n.find("input:file[required]");s.size()>0&&$.each(s,function(){$(this).val()&&(t.data=t.data+"&"+$(this).attr("name")+"=1")}),t.data=t.data+"&current_page="+c.index(n)},success:function(e){if(null!==e&&"object"==typeof e&&(n.find(".error-block").remove(),n.find(".form-group").removeClass("has-error"),$.each(e,function(e,t){var o=n.find("#"+e).parent(".form-group");if(o.size()>0){s=!0,o.addClass("has-error");var i=$("<div>",{class:"help-block error-block",html:t});o.append(i)}})),!s){n.hide();var t=$(".steps");if(t.size()>0)t.find(".step").eq(c.index(n)).removeClass("current"),t.find(".step").eq(c.index(a)).prevAll().addClass("success"),t.find(".step").eq(c.index(a)).addClass("current");else{var o=$(".progress").first().find(".progress-bar"),i=o.find(".percent"),r=o.find(".title"),d=o.data("titles");if(void 0!==d){var p=(d=d.split(","))[c.index(a)];r.html(p)}var f=Math.round(100/c.size()*c.index(a))+"%";i.text(f),o.width(f)}a.show(),l=n}formEl.trigger("nextStep"),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})},error:function(){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger"),formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}})},window.previousStep=function(e){if(e.preventDefault(),l.is("fieldset")){n=$(this).parents("fieldset");for(var t=0;t<options.skips.length;t++)if(c.index(n)==options.skips[t].to){l=c.eq(options.skips[t].from);break}var s=$(".steps");if(s.size()>0)s.find(".step").removeClass("success"),s.find(".step").eq(c.index(n)).removeClass("current"),s.find(".step").eq(c.index(l)).prevAll().addClass("success"),s.find(".step").eq(c.index(l)).addClass("current");else{var o=$(".progress").first().find(".progress-bar"),i=o.find(".percent"),r=o.find(".title"),a=o.data("titles");if(void 0!==a){var d=(a=a.split(","))[c.index(l)];r.html(d)}var p=Math.round(100/c.size()*c.index(l))+"%";i.text(p),o.width(p)}n.hide(),l.show(),l=l.prev(),formEl.trigger("previousStep"),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}},$("input").on("keypress",function(e){if(13==e.keyCode){var t=$(e.currentTarget).parents("fieldset").find(".next");if(t.size()>0)return e.preventDefault(),t.click(),!1}}),$(".next").click(nextStep),$(".previous").click(previousStep),formEl.ajaxForm({url:options.actionUrl,type:"post",beforeSubmit:function(e,t,s){if("preview"===options.mode)return!1;if(t.find(":file").val()){d.show();p.css("width","0%"),f.html("0% "+options.i18n.complete),Utils.postMessage({height:$("body").outerHeight(!0)})}formEl.find(":submit").attr("disabled",!0)},uploadProgress:function(e,t,s,o){var i=o+"%";p.css("width",i),f.html(i+" "+options.i18n.complete)},success:function(e){e.success?(s(),o(e)):r(e)},error:function(e,t,s){Utils.showMessage("#messages",options.i18n.unexpectedError,"danger"),formEl.hide(),Utils.postMessage({height:$("body").outerHeight(!0)}),Utils.postMessage({scrollToTop:"container"})}}),options.analytics&&(!function(e,t,s,o,i,r,n){e[i]||(e.FA=e.FA||[],e.FA.push(i),e[i]=function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].q=e[i].q||[],r=t.createElement(s),n=t.getElementsByTagName(s)[0],r.async=1,r.src=o,n.parentNode.insertBefore(r,n))}(window,document,"script",options.tracker,"tracker"),window.tracker("newTracker","t"+options.id,options.app,{encodeBase64:!1,appId:options.id}),formEl.on("view",function(e){window.tracker("setCustomUrl",decodeURIComponent(Utils.getUrlVars().url)),window.tracker("setReferrerUrl",decodeURIComponent(Utils.getUrlVars().referrer)),window.tracker("trackPageView",decodeURIComponent(Utils.getUrlVars().title))}),formEl.on("fill",function(e){window.tracker("trackStructEvent","form","fill","start",null,null)}),formEl.on("error",function(e){window.tracker("trackStructEvent","form","error",null,null,null)}),formEl.on("success",function(e,t,s){window.tracker("trackStructEvent","form","submit",t.id,"time",s)}))});
(function(b){b.fn.actionsBuilder=function(d){if(d=="data"){var c=b(this).eq(0).data("actionsBuilder");return c.collectData()}else{return b(this).each(function(){var e=new a(this,d);b(this).data("actionsBuilder",e)})}};function a(d,c){this.element=b(d);this.options=c||{};this.init()}a.prototype={init:function(){this.fields=this.options.actions;this.data=this.options.data||[];var c=this.buildActions(this.data);this.element.html(c)},buildActions:function(e){var c=b("<div>",{"class":"actions"});var l=b("<div>",{"class":"action-buttons"});l.append(b("<span>",{text:options.i18n.followingActions,style:"margin-right:20px;display:inline-block"}));var k=b("<span>",{"class":"glyphicon glyphicon-plus",text:" "});var n=b("<a>",{href:"#","class":"add btn btn-success btn-xs",text:options.i18n.addAction});n.prepend(k);var h=this;n.click(function(i){i.preventDefault();c.append(h.buildAction({}))});l.append(n);c.append(l);for(var f=0;f<e.length;f++){var j=e[f];var d=this.buildAction(j);var g=[j];var m;while(m=g.shift()){d.find(":input[name='"+m.name+"']").val(m.value).change();if(m.fields){g=g.concat(m.fields)}}c.append(d)}return c},buildAction:function(d){var l=this._findField(d.name);var c=b("<div>",{"class":"action"});var h=b("<div>",{"class":"subfields"});var m=b("<select>",{"class":"action-select form-control",name:"action-select"});for(var e=0;e<this.fields.length;e++){var n=this.fields[e];var f=b("<option>",{text:n.label,value:n.name});m.append(f)}var g=this;m.change(function(){var q=b(this).val();var p=g._findField(q);h.empty();if(p.fields){for(var o=0;o<p.fields.length;o++){h.append(g.buildField(p.fields[o]))}}c.attr("class","action "+q)});var k=b("<span>",{"class":"glyphicon glyphicon-remove",text:" "});var j=b("<a>",{href:"#","class":"remove btn btn-danger btn-xs",text:options.i18n.deleteText});j.prepend(k);j.click(function(i){i.preventDefault();b(this).trigger("remove");c.remove()});if(l){m.val(l.name);m.change();if(d.fields){for(e=0;e<d.fields.length;e++){h.find(":input[name="+d.fields[e].name+"]").val(d.fields[e].label)}}}else{m.change()}c.append(m);c.append(h);c.append(j);return c},buildField:function(m){var c=b("<div>",{"class":"field"});var j=b("<div>",{"class":"subfields"});var k=this;var n=b("<label>",{"class":"control-label",text:m.label});c.append(n);if(m.fieldType=="select"){var n=b("<label>",{"class":"control-label",text:m.label});var o=b("<select>",{"class":"form-control",name:m.name});for(var g=0;g<m.options.length;g++){var f=m.options[g];var h=b("<option>",{text:f.label,value:f.name});h.data("optionData",f);o.append(h)}o.change(function(){var q=b(this).find("> :selected");var s=q.data("optionData");j.empty();if(typeof s!=="undefined"&&typeof s.fields!=="undefined"){for(var p=0;p<s.fields.length;p++){var r=s.fields[p];j.append(k.buildField(r))}}});o.change();c.append(o)}else{if(m.fieldType=="select_multiple"){var n=b("<label>",{"class":"control-label",text:m.label});var o=b("<select></select>",{"class":"form-control",name:m.name,multiple:true});for(var g=0;g<m.options.length;g++){var f=m.options[g];var h=b("<option>",{text:f.label,value:f.name});h.data("optionData",f);o.append(h)}o.change(function(){var q=b(this).find("> :selected");var s=q.data("optionData");j.empty();if(typeof s!=="undefined"&&typeof s.fields!=="undefined"){for(var p=0;p<s.fields.length;p++){var r=s.fields[p];j.append(k.buildField(r))}}});o.change();c.append(o)}else{if(m.fieldType=="text"){var l=b("<input>",{"class":"form-control",type:"text",name:m.name});c.append(l)}else{if(m.fieldType=="textarea"){var e="textarea-"+Math.floor(Math.random()*100000);var d=b("<textarea>",{"class":"form-control",name:m.name,id:e});c.append(d)}}}}if(m.hint){c.append(b("<p>",{"class":"hint",text:m.hint}))}c.append(j);return c},collectData:function(c){var e=this;c=c||this.element.find(".action");var d=[];c.each(function(){var g=b(this).find("> :input, > .jstEditor > :input");var f=b(this).find("> .subfields > .field");var h={name:g.attr("name"),value:g.val()};if(f.length>0){h.fields=e.collectData(f)}d.push(h)});return d},_findField:function(e){for(var c=0;c<this.fields.length;c++){var d=this.fields[c];if(d.name==e){return d}}}}})(jQuery);